
@()

@import utils.MenuType._

@org = @{
    DevFarm.getOrganization()
}

@getPopupTitle = { @if(User.enrolled(org)) { @Messages("organization.you.want.to.be.a.member", org.name) } else { @Messages("organization.you.may.want.to.be.a.member", org.name) } }
@getRequestUrl = { @if(User.enrolled(org)) { @routes.EnrollOrganizationApp.cancelEnroll(org.name) } else { @routes.EnrollOrganizationApp.enroll(org.name) } }
@getClassName = { @if(User.enrolled(org)) { yobicon-removefriend } else { yobicon-addfriend } }
@getEnrollmentButtonTitle = { @if(User.enrolled(org)) { @Messages("button.cancel.enrollment") } else { @Messages("button.new.enrollment") } }
@getEnrollmentHelp = { @if(User.enrolled(org)) { @Messages("organization.member.enrollment.help.after") } else { @Messages("organization.member.enrollment.help.before") } }

@noticeProject = @{
    Project.findByOwnerAndProjectName(DevFarm.ORGANIZATION_NAME, DevFarm.NOTICE_PROJECT_NAME)
}

@noticePosts = @{
    Posting.findRecentlyCreated(noticeProject, DevFarm.NOTICES_LATEST)
}

@latestPosts = @{
    DevFarm.getLatestPosts();
}

@siteLayout(Messages("devfarm.latest"), SITE_HOME) {

    @if(UserApp.currentUser() == User.anonymous){
        @views.html.index.partial_intro()
    } else {

    <div class="page-wrap-outer">
        <div class="page-wrap">
            <div class="site-guide-outer hide">

                <h3>
                    <span><strong>@Messages("app.welcome",utils.Config.getSiteName)</strong> - @Messages("app.description")</span>
                </h3>
                <table class="welcome-table table borderless">
                    <tr>
                        <td>@Html(Messages("devfarm.description"))</td>
                    </tr>
                    <tr class="bubble-wrap gray">
                        <td>@Html(Messages("devfarm.description2"))</td>
                    </tr>
                    <tr class="bubble-wrap gray">
                        <td>@Html(Messages("devfarm.description3"))</td>
                    </tr>
                </table>

                @if( DevFarm.isAdmin(UserApp.currentUser) || DevFarm.isMember(UserApp.currentUser) ) {
                    @if( noticeProject != null ) {
                        <div class="title_area">
                            <h2 class="pull-left">@noticeProject.name</h2>
                        </div>
                        @if( noticePosts.isEmpty() ) {
                            <div class="error-wrap">
                                <i class="ico ico-err1"></i>
                                <p>@Messages("post.is.empty")</p>
                            </div>
                        } else {
                            <ul class="post-list-wrap">
                            @for(post <- noticePosts) {
                                @views.html.board.partial_list(post, noticeProject)
                            }
                            </ul>
                        }
                    }

                } else {

                    @if( OrganizationUser.isGuest(org, UserApp.currentUser)) {
                        <div class="error-wrap" style=" padding: 70px 0px 150px 0px">
                            <p>@Messages("devfarm.forbidden", org.name)</p>
                            <p class="message">@Messages("devfarm.enroll.message", org.name)</p>
                            <div class="project-util-wrap" style="position: absolute;
                                left: 50%;
                                transform: translateX(-50%);">
                                <ul class="project-util">
                                    <button class="ybtn ybtn-small @if(User.enrolled(org)) { ybtn-info } dropdown-toggle" type="button" data-toggle="dropdown">
                                        <i class="yobicon-addfriend"></i> @Messages("organization.member.enrollment.title")
                                    </button>
                                    <div class="dropdown-menu flat right title">
                                        <div class="pop-title">@getPopupTitle</div>
                                        <div class="pop-content">
                                        @getEnrollmentHelp
                                        </div>
                                        <div class="pop-content btn-wrap">
                                            <a class="ybtn @if(!User.enrolled(org)) { ybtn-info } enrollBtn" href="@getRequestUrl" id="enrollBtn">
                                                <i class="@getClassName"></i>
                                                @getEnrollmentButtonTitle
                                            </a>
                                        </div>
                                    </div>
                                </ul>
                            </div>
                        </div>
                    }

                }

            </div>
            <div class="guide-toggle">
                <button class="btn-transparent" id="toggleIntro"><i class="yobicon-resizev"></i></button>
            </div>
            <div class="page on-fold-intro">

                <div class="row-fluid content-container">
                    <div class="span8 main-stream">

                        @views.html.common.mySeriesMenuTab(TAB_LATESTS)

                        @if( DevFarm.isAdmin(UserApp.currentUser) || DevFarm.isMember(UserApp.currentUser) ) {

                            @if( latestPosts.isEmpty() ){
                                <div class="error-wrap">
                                    <i class="ico ico-err1"></i>
                                    <p>@Messages("post.is.empty")</p>
                                </div>
                            } else {
                                <ul class="post-list-wrap">
                                    @for(post <- latestPosts) {
                                        @views.html.organization.group_board_list_partial(post, post.project)
                                    }
                                    <li><a href="@routes.BoardApp.organizationBoards(org.name)" id="latests-more" class="ybtn">More</a></li>
                                </ul>
                            }

                        }

                    </div>
                    <div class="span4 index-menu right-menu span-hard-wrap">
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script type="text/javascript">
        $(function(){
            $("#toggleIntro").click(function(){
                var $outerGuide = $(".site-guide-outer");
                $outerGuide.toggleClass("hide");
                localStorage.setItem("yobi-intro", !$outerGuide.hasClass("hide"));
            });

            if(localStorage.getItem("yobi-intro") != "false"){
                $(".site-guide-outer").removeClass("hide");
            }

            // Show side bar menu default and focus to search box
            // Also, see layout.scala.html for normal user menu click !!
            var requiredLoggedIn = $("#required-logged-in").length === 1;
            if(!requiredLoggedIn){
                var viewSize = $(window).width();
                if( viewSize > 720) {
                    $("#mySidenav").width("420px").css("border", "1px solid #ccc");
                    setTimeout(function () {
                        $("#main").off("click");
                    }, 1000);
                    $(".search-input").focus();
                } else {
                    $("#mySidenav").width("100vw").css("border", "1px solid #ccc");
                }
            }

            if ($(".admin-logged-in-affix").length === 1) {
                $(".sidenav").css("top", "84px");
            }

            var $setDefaultLoginPage = $("#setDefaultLoginPage");
            $setDefaultLoginPage.popover();
            $setDefaultLoginPage.on('click', function(){
                $.post("@routes.UserApp.setDefaultLoginPage()?path=" + $setDefaultLoginPage.data("url"))
                        .done(function (data) {
                            $yobi.notify("Set to default: " + data.defaultLoginPage, 3000);
                            $setDefaultLoginPage.hide();
                        })
                        .fail(function (data) {
                            $yobi.alert("set Default page failed: " + data);
                        });
            });
        });
    </script>

    <script language="javascript">
        $(function() {
            $yobi.loadModule("organization.Global")
        })
    </script>

    <style type="text/css">
        .page-wrap .title_area {
            overflow: hidden;
            margin-top: 14px;
            margin-bottom: 14px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        .page-wrap .title_area h2 {
            margin: 0;
            font-size: 1.5em;
            color: #4c4c4c;
            line-height: 30px;
        }
        .site-guide-outer .post-list-wrap {
            margin-bottom: -1px;
        }
        .site-guide-outer .error-wrap {
            border-bottom: 1px solid #ddd;
            margin-bottom: -1px;
        }
        #latests-more {
            margin-top: 20px;
            width: 95%;
        }
        h3 strong {
            font-size: 1.3em;
            color: #FF7332;
        }
        .welcome-table strong {
            color: #3592b5;
        }
        .welcome-table .bubble-wrap strong {
            color: #FF7332;
        }
        .error-wrap p.message {
            font-weight: normal;
            font-size: 14px;
            margin: 20px 0;
        }
    </style>

    }
}