
@()

@import utils.MenuType._

@org = @{
    DevFarm.getOrganization()
}

@getPopupTitle = { @if(User.enrolled(org)) { @Messages("organization.you.want.to.be.a.member", org.name) } else { @Messages("organization.you.may.want.to.be.a.member", org.name) } }
@getRequestUrl = { @if(User.enrolled(org)) { @routes.EnrollOrganizationApp.cancelEnroll(org.name) } else { @routes.EnrollOrganizationApp.enroll(org.name) } }
@getClassName = { @if(User.enrolled(org)) { yobicon-removefriend } else { yobicon-addfriend } }
@getEnrollmentButtonTitle = { @if(User.enrolled(org)) { @Messages("button.cancel.enrollment") } else { @Messages("button.new.enrollment") } }
@getEnrollmentHelp = { @if(User.enrolled(org)) { @Messages("organization.member.enrollment.help.after") } else { @Messages("organization.member.enrollment.help.before") } }

@noticeProject = @{
    Project.findByOwnerAndProjectName(DevFarm.ORGANIZATION_NAME, DevFarm.NOTICE_PROJECT_NAME)
}

@noticePosts = @{
    Posting.findRecentlyCreated(noticeProject, DevFarm.ITEMS_LATEST)
}

@siteLayout(Messages("devfarm.latest"), SITE_HOME) {

    <div>
        <button class="btn-transparent" id="toggleIntro"></button>
    </div>
    <div class="page-wrap-outer">
        <div class="page-wrap">
            @views.html.common.mySeriesMenuTab(TAB_LATESTS)

            <div class="row-fluid content-container">
                <div class="span8 main-stream">

                    @if( DevFarm.isAdmin(UserApp.currentUser) || DevFarm.isMember(UserApp.currentUser) ) {
                        <div class="title_area">
                            <h3 class="pull-left">@noticeProject.name</h3>
                        </div>
                        <ul class="post-list-wrap">
                        @for(post <- noticePosts) {
                            @views.html.board.partial_list(post, noticeProject)
                        }
                        </ul>
                    } else {
                        <div class="error-wrap" style="position:relative">
                            <p>@Messages("devfarm.forbidden", org.name)</p>
                            <div class="project-util-wrap" style="position:absolute; left: 50%; transform: translateX(-50%);">
                                <ul class="project-util">
                                    <button class="ybtn ybtn-small @if(User.enrolled(org)) { ybtn-info } dropdown-toggle" type="button" data-toggle="dropdown">
                                        <i class="yobicon-addfriend"></i> @Messages("organization.member.enrollment.title")
                                    </button>
                                    <div class="dropdown-menu flat right title">
                                        <div class="pop-title">@getPopupTitle</div>
                                        <div class="pop-content">
                                        @getEnrollmentHelp
                                        </div>
                                        <div class="pop-content btn-wrap">
                                            <a class="ybtn @if(!User.enrolled(org)) { ybtn-info } enrollBtn" href="@getRequestUrl" id="enrollBtn">
                                                <i class="@getClassName"></i>
                                                @getEnrollmentButtonTitle
                                            </a>
                                        </div>
                                    </div>
                                </ul>
                            </div>
                        </div>
                    }

                </div>
                <div class="span4 index-menu right-menu span-hard-wrap">
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function(){

            // Show side bar menu default and focus to search box
            // Also, see layout.scala.html for normal user menu click !!
            var requiredLoggedIn = $("#required-logged-in").length === 1;
            if(!requiredLoggedIn){
                var viewSize = $(window).width();
                if( viewSize > 720) {
                    $("#mySidenav").width("420px").css("border", "1px solid #ccc");
                    setTimeout(function () {
                        $("#main").off("click");
                    }, 1000);
                    $(".search-input").focus();
                } else {
                    $("#mySidenav").width("100vw").css("border", "1px solid #ccc");
                }
            }

            if ($(".admin-logged-in-affix").length === 1) {
                $(".sidenav").css("top", "84px");
            }

            var $setDefaultLoginPage = $("#setDefaultLoginPage");
            $setDefaultLoginPage.on('click', function(){
                $.post("@routes.UserApp.setDefaultLoginPage()?path=" + $setDefaultLoginPage.data("url"))
                        .done(function (data) {
                            $yobi.notify("Set to default: " + data.defaultLoginPage, 3000);
                            $setDefaultLoginPage.hide();
                        })
                        .fail(function (data) {
                            $yobi.alert("set Default page failed: " + data);
                        });
            });
        });
    </script>
    <script language="javascript">
        $(function() {
            $yobi.loadModule("organization.Global")
        })
    </script>

}